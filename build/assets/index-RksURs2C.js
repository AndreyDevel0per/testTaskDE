var S=Object.defineProperty;var j=r=>{throw TypeError(r)};var I=(r,t,e)=>t in r?S(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var c=(r,t,e)=>I(r,typeof t!="symbol"?t+"":t,e),P=(r,t,e)=>t.has(r)||j("Cannot "+e);var y=(r,t,e)=>(P(r,t,"read from private field"),e?e.call(r):t.get(r)),m=(r,t,e)=>t.has(r)?j("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(r):t.set(r,e),v=(r,t,e,o)=>(P(r,t,"write to private field"),o?o.call(r,e):t.set(r,e),e),f=(r,t,e)=>(P(r,t,"access private method"),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const u of n.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&o(u)}).observe(document,{childList:!0,subtree:!0});function e(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(s){if(s.ep)return;s.ep=!0;const n=e(s);fetch(s.href,n)}})();const J={userName:[{type:"required",message:"Имя пользователя обязательно"},{type:"minLength",params:3,message:"Имя должно быть не менее 3 символов"},{type:"maxLength",params:20,message:"Имя не должно превышать 20 символов"}],email:[{type:"required",message:"Электронная почта обязательна"},{type:"email",message:"Введите корректный адрес электронной почты"}],text:[{type:"required",message:"Поле не должно быть пустым"}],password:[{type:"required",message:"Пароль обязателен"},{type:"minLength",params:6,message:"Пароль должен быть не менее 6 символов"}],confirmPassword:[{type:"required",message:"Подтвердите пароль"},{type:"equals",params:"password",message:"Пароли не совпадают"}]};var A,x;class K{constructor(t){m(this,A);this.rules=t||J,this.errors={}}validateForm(t){this.errors={};const e=t.elements;for(const o in this.rules){const s=e[o];if(!s||!s.getAttribute("data-js-input-required"))continue;const n=this.rules[o],u=s.value.trim();for(const w of n){const{type:C,message:M,params:g}=w;f(this,A,x).call(this,C,u,g,t)||(this.errors[o]||(this.errors[o]=[]),this.errors[o].push(M))}}return Object.keys(this.errors).length===0}getErrors(){return this.errors}displayErrors(t){t.querySelectorAll(".errorMessage").forEach(e=>e.remove());for(const e in this.errors){const o=t.elements[e];if(!o)continue;const s=this.errors[e].join(", "),n=document.createElement("div");n.className="errorMessage",n.textContent=s,o.parentNode.insertBefore(n,o.nextSibling)}}}A=new WeakSet,x=function(t,e,o,s){switch(t){case"required":return e!=="";case"minLength":return e.length>=o;case"maxLength":return e.length<=o;case"pattern":return new RegExp(o).test(e);case"email":return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e);case"equals":const n=s.elements[o];return n&&e===n.value;default:return!0}};var b,E,h;const i=class i{constructor(){return i.instance||(i.instance=this),i.instance}static lock(){v(i,h,!0),document.documentElement.style.setProperty(y(i,b),-1*document.documentElement.scrollTop+"px"),v(i,E,document.documentElement.scrollTop),document.documentElement.classList.add(i.stateClasses.noscroll)}static unlock(){v(i,h,!1),document.documentElement.classList.remove(i.stateClasses.noscroll),window.scrollTo(0,y(i,E)),document.documentElement.style.removeProperty(y(i,b))}get isLocked(){return y(i,h)}};b=new WeakMap,E=new WeakMap,h=new WeakMap,m(i,b,"--st"),m(i,E,0),m(i,h,!1),c(i,"instance"),c(i,"stateClasses",{noscroll:"noscroll"});let L=i;var p,V,$;const a=class a{constructor(){m(this,p);c(this,"attrs",{modal:"data-js-modal",button:"data-js-modal-button",closeButton:"data-js-modal-close"});if(a.instance)return a.instance;this.currentModal=null,f(this,p,$).call(this),a.instance=this}openModal(t){const e=document.querySelector(`[${this.attrs.modal}="${t}"]`);e&&(e.classList.replace(a.stateClasses.close,a.stateClasses.open),L.lock(),this.currentModal=e)}closeModal(){this.currentModal.classList.replace(a.stateClasses.open,a.stateClasses.close),L.unlock()}};p=new WeakSet,V=function(t){const{target:e}=t;if(e.hasAttribute(`${this.attrs.button}`)){const s=e.getAttribute(this.attrs.button);this.openModal(s);return}if(e.hasAttribute(this.attrs.closeButton)){const s=e.closest(`[${this.attrs.modal}]`);s&&this.closeModal(s);return}const o=e.closest(`[${this.attrs.modal}]`);o&&e===o&&this.closeModal(o)},$=function(){document.addEventListener("click",t=>{f(this,p,V).call(this,t)})},c(a,"instance"),c(a,"stateClasses",{open:"visible",close:"hidden"});let q=a;var d,R,D,T;const l=class l{constructor(){m(this,d);c(this,"attrs",{form:"data-js-form"});if(l.instance)return l.instance;f(this,d,T).call(this),this.modalManager=new q,this.formValidator=new K(this.rules),l.instance=this}static getInstance(){return l.instance||(l.instance=new l),l.instance}};d=new WeakSet,R=function(t){if(!t.getAttribute("data-js-form-validation-required"))return!0;const e=this.formValidator.validateForm(t);return e?console.debug("Форма валидна, отправляем данные."):(console.error("Ошибки валидации:",this.formValidator.getErrors()),this.formValidator.displayErrors(t)),e},D=function(t){const{target:e,submitter:o}=t;if(!e.hasAttribute(`${this.attrs.form}`)||!e.tagName.toLowerCase()==="form")return;const s=JSON.parse(e.getAttribute(this.attrs.form)),{url:n,method:u="POST",showModalAfterSuccess:w,showModalAfterError:C,preventDefault:M=!0,redirectUrlAfterSuccess:g=!1,delayBeforeRedirect:O=!1}=s,B=new FormData(e);M&&t.preventDefault(),f(this,d,R).call(this,e)&&(o.disabled=!0,fetch(n,{method:u,body:B}).then(F=>{F.ok?w&&(this.modalManager.closeModal(),this.modalManager.openModal(w)):(this.modalManager.closeModal(),this.modalManager.openModal(C)),g&&(O?setTimeout(()=>{location.href=g},O):location.href=g)}).finally(()=>{o.disabled=!1}))},T=function(){document.addEventListener("submit",t=>{f(this,d,D).call(this,t)},!0)},c(l,"instance");let N=l;function U(){return new Promise(r=>{document.readyState==="loading"?document.addEventListener("DOMContentLoaded",r):r()})}Promise.resolve(U()).then(()=>{new N,new q});
